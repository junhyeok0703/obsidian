
### WITH문 가독성관점

![[Pasted image 20250125223729.png]]

안쪽부터 밖으로 간다. 복잡해진다. (반복이 많아진다.)

![[Pasted image 20250125223807.png]]
![[Pasted image 20250125223827.png]]
변수같이 쓰는것.


### WITH 구문
CTE(common table expression)라고 표현
SELECT구문에 이름을 정해주는 것과 유사
쿼리 내에서 반복적으로 사용할 수 있음

걍 변수에 테이블결과를 넣는것과 같다.

![[Pasted image 20250125223940.png]]


### base table
베이스 테이블이다 해서 베이스 해가지고 이렇게 만들고 그 다음에는 이름을 지을때 베이스는 기본적인 데이터셋을 만들 때 많이 쓴다. 그다음에는 명시적인 이름을 쓴다.
![[Pasted image 20250125224115.png]]

### PARTITION 비용관점
Table엔 파티션이란 것이 존재할 수 있음

파티션을 사용하면 좋다.
![[Pasted image 20250125224307.png]]
이런식으로 날짜별로 파티션이 되어있는 경우는 1월2일날에 물건을 보고싶다. 라고하면 거기서 찾으면 훨씬 비용효율적이다.
빅쿼리는 탐색 비용이 돈이기 때문에 쪼개져있는것들을 보는게 훨씬 낫다


파티션의 좋은점(날짜로 파티션을 많이 함)
1. 쿼리성능향상
	- 전체 데이터를 스캔하는것보다 훨씬 빠름
2. 데이터 관리 용이성
	- 특정 일자의 데이터를 모두 변경하거나 삭제해야 하면 파티션을 설정해 삭제할수있다.
3. 비용
	- 파티션에 해당되는 데이터만 스캔해서 비용을 줄일 수 있음
		빅쿼리는 쿼리 용량에 비례해서 과금하기 때문

### 파티션 테이블에서 쿼리하기
WHERE절에 파티션 컬럼에 대해 조건을 설정해서 사용
![[Pasted image 20250125224731.png]]
이 쿼리는 2023-12-19부터 하루 전날의 데이터를 추출하는 쿼리(저장된 데이터는 더 과거 데이터라 이 쿼리를 돌릴 때 결과는 나오지 않음)
결론은 전에 있던 데이터를 불러오지않게 되고 이시기에만 필요한 데이터를 불러오니까 당연히 비용효율적이고 빠름 , 파티션을 이렇게 하는거임


